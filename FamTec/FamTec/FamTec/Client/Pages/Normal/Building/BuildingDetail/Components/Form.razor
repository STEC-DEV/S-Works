@using FamTec.Client.Pages.CommonComponents
@using FamTec.Shared.Client.Class
@using FamTec.Shared.Client.DTO.Normal.Buildings
@using System.Reflection

<div class="form">
    <div class="buildinginfo-contents">
        <div class="building-img">
            @if (EditMode)
            {
                <InputImages MaxFilesNum="1" OnChange="OnUploadImage" />
            }
            <PreviewBox ImageUrls=@Image />
        </div>
        <div class="infosection-1">
            <InputFieldSmall InputType="text" Label="건물코드" EditMode=EditMode @bind-Value="@(Building.Code)" />
            <InputFieldSmall InputType="text" Label="건물이름" EditMode=EditMode @bind-Value="@Building.Name" />
            <InputFieldSmall InputType="text" Label="건물주소" EditMode=EditMode @bind-Value="@Building.Address" />
            <InputFieldSmall InputType="text" Label="대표전화" EditMode=EditMode @bind-Value="@Building.Tel" />
            <InputFieldSmall InputType="text" Label="건물구조" EditMode=EditMode @bind-Value="@Building.BuildingStruct" />
            <InputFieldSmall InputType="text" Label="건물용도" EditMode=EditMode @bind-Value="@Building.Usage" />
            <InputFieldSmall InputType="text" Label="시공업체" EditMode=EditMode @bind-Value="@Building.ConstCompany" />
            <InputFieldSmall InputType="text" Label="준공년월" EditMode=EditMode @bind-Value="@Building.CompletionDT" />
            <InputFieldSmall InputType="text" Label="지붕구조" EditMode=EditMode @bind-Value="@Building.RoofStruct" />
            <InputFieldSmall InputType="text" Label="소방등급" EditMode=EditMode @bind-Value="@Building.FireRating" />
            <InputFieldSmall InputType="text" Label="정화조용량" EditMode=EditMode @bind-Value="@Building.SeptictankCapacity" />
        </div>
    </div>
    <div class="infosection-2">
        <GroupField Title="면적"
                    Sub1="연면적"
                    Sub2="대지면적"
                    Sub3="건축면적"
                    @bind-Data1="@Building.GrossFloorArea"
                    @bind-Data2="@Building.LandArea"
                    @bind-Data3="@Building.BuildingArea" />
        <GroupField Title="층" Sub1="전체" Sub2="지상" Sub3="지하"
                    @bind-Data1="@Building.FloorNum"
                    @bind-Data2="@Building.GroundFloorNum"
                    @bind-Data3="@Building.BasementFloorNum"
                    EditMode=EditMode />
        <GroupField Title="높이" Sub1="전체" Sub2="지상" Sub3="지하"
                    @bind-Data1="@Building.BuildingHeight"
                    @bind-Data2="@Building.GroundHeight"
                    @bind-Data3="@Building.BasementHeight"
                    EditMode=EditMode />

        <GroupField Title="주차장" Sub1="대수" Sub2="옥내" Sub3="옥외"
                    @bind-Data1="@Building.ParkingNum"
                    @bind-Data2="@Building.InnerParkingNum"
                    @bind-Data3="@Building.OuterParkingNum"
                    EditMode=EditMode />
        <GroupField Title="용량" Sub1="전기" Sub2="수전" Sub3="발전"
                    @bind-Data1="@Building.ElecCapacity"
                    @bind-Data2="@Building.FaucetCapacity"
                    @bind-Data3="@Building.GenerationCapacity"
                    EditMode=EditMode />

        <GroupField Title="물" Sub1="급수용량" Sub2="고가수조" Sub3="저수조"
                    @bind-Data1="@Building.WaterCapacity"
                    @bind-Data2="@Building.ElevWaterCapacity"
                    @bind-Data3="@Building.WaterTank"
                    EditMode=EditMode />
        <GroupField Title="가스" Sub1="용량" Sub2="보일러" Sub3="냉온수기"
                    @bind-Data1="@Building.GasCapacity"
                    @bind-Data2="@Building.Boiler"
                    @bind-Data3="@Building.WaterDispenser"
                    EditMode=EditMode />
        <GroupField Title="승강기" Sub1="대수" Sub2="인승용" Sub3="화물용"
                    @bind-Data1="@Building.LiftNum"
                    @bind-Data2="@Building.PeopleLiftNum"
                    @bind-Data3="@Building.CargoLiftNum"
                    EditMode=EditMode />
        <GroupField Title="냉·난방" Sub1="용량" Sub2="난방용량" Sub3="냉방용량"
                    @bind-Data1="@Building.CoolHeatCapacity"
                    @bind-Data2="@Building.HeatCapacity"
                    @bind-Data3="@Building.CoolCapacity"
                    EditMode=EditMode />
        <GroupField Title="조경" Sub1="조경면적" Sub2="지상" Sub3="옥상"
                    @bind-Data1="@Building.LandScapeArea"
                    @bind-Data2="@Building.GroundArea"
                    @bind-Data3="@Building.RooftopArea"
                    EditMode=EditMode />
        <GroupField Title="화장실" Sub1="전체" Sub2="남자" Sub3="여자"
                    @bind-Data1="@Building.ToiletNum"
                    @bind-Data2="@Building.MenToiletNum"
                    @bind-Data3="@Building.WomenToiletNum"
                    EditMode=EditMode />
    </div>
</div>


@code {
    [Parameter] public BuildingDTO? Building { get; set; }
    [Parameter] public bool EditMode{ get; set; }
    [Parameter] public List<string> Image {get;set;}


    protected override async Task OnInitializedAsync()
    {

    }


    private async void OnUploadImage(List<ImageFile> images)
    {
        List<byte[]> temp = new List<byte[]>();
        List<string> names = new List<string>();

        foreach (var image in images)
        {
            Console.WriteLine("하위 LIST개수" +Image.Count);
            Building.Image = image.Image;
            Building.ImageName = image.Name;
            string base64String = Convert.ToBase64String(image.Image);
            if(Image.Count != 0)
            {
                Image[0] = ($"data:image/jpeg;base64,{base64String}");
            }else{
                Image.Add($"data:image/jpeg;base64,{base64String}");
            }

    }


        StateHasChanged();
    }


    // private void OnEditMode()
    // {
    //     EditMode = !EditMode;
    //     StateHasChanged();
    // }
}
