@page "/users/add"
@using FamTec.Client.Pages.Normal.User.UserAdd.Components
@using FamTec.Client.Pages.CommonComponents
@using FamTec.Shared.Client.DTO.Normal.Users
@using FamTec.Shared.Server.DTO

<div class="useradd-container">
    <div class="useradd-wrap">
        <div class="useradd-info">
            <SignForm UserInfo="@User.UserInfo" EditMode=@EditMode />
        </div>
        <div class="useradd-perm">
            <UserPermComponent UserPerm="@User.UserPerm" OnVocActive="@OnVocActive" />
        </div>
        @if (isVocPerm)
        {
            <div class="useradd-sub yappear">
                <UserVocPermComponent UserVocPerm="@User.UserVocPerm" />
            </div>
        }
    </div>
    <div class="useradd-btns">
        <Button Name="등록" Width=true Type=0 OnClick="@OnAdd" />
        <Button Name="취소" Width=true Type=1 OnClick="@OnCancle" />
    </div>
</div>

@code {
    bool isVocPerm = false;
    bool EditMode = true;
    UserDTO User;


    protected override Task OnInitializedAsync()
    {
        User = new UserDTO()
        {
            UserInfo = new UserInfoDTO(),
            UserPerm = new UserPermDTO(),
            UserVocPerm = new UserVocPermDTO(),
        };

        return base.OnInitializedAsync();
    }



    private void OnVocActive(UserPermDTO updatedPerm)
    {
        Console.WriteLine("ㅁㄴㅇ");
        // User.UserPerm = updatedPerm;
        isVocPerm = !isVocPerm;
        StateHasChanged();
    }

    private async void OnAdd()
    {
        Console.WriteLine(User.UserInfo.Name);
        Console.WriteLine(User.UserInfo.UserId);
        Console.WriteLine(User.UserInfo.Phone);
        Console.WriteLine(User.UserInfo.Password);
        Console.WriteLine(User.UserInfo.Email);
        Console.WriteLine("기본" + User.UserPerm.BasicPerm);
        Console.WriteLine("기계" + User.UserPerm.MachinPerm);
        Console.WriteLine("전기" + User.UserPerm.ElecPerm);
        Console.WriteLine("승강" + User.UserPerm.LiftPerm);
        Console.WriteLine("소방" + User.UserPerm.FirePerm);
        Console.WriteLine("건축" + User.UserPerm.ConstructPerm);
        Console.WriteLine("통신" + User.UserPerm.NetworkPerm);
        Console.WriteLine("미하" + User.UserPerm.BeautyPerm);
        Console.WriteLine("보안" + User.UserPerm.SecurityPerm);
        Console.WriteLine("자재" + User.UserPerm.MaterialPerm);
        Console.WriteLine("에너지" + User.UserPerm.EnergyPerm);
        Console.WriteLine("사용자" + User.UserPerm.UserPerm);
        Console.WriteLine("민원" + User.UserPerm.VocPerm);
        Console.WriteLine("민기" + User.UserVocPerm.MachineVoc);
        Console.WriteLine("민건" + User.UserVocPerm.ConstructVoc);
        Console.WriteLine("민통" + User.UserVocPerm.NetworkVoc);
        Console.WriteLine("민보" + User.UserVocPerm.SecurityVoc);
        Console.WriteLine("img" + User.UserInfo.Image);
        Console.WriteLine("img" + User.UserInfo.ImageName);

        ResponseUnit<UserDTO> resAdd = await apiManager.PostWithFilesAsync<UserDTO>("User/sign/AddUser", User);
        if(resAdd.code != 200)
        {
            await JS.InvokeVoidAsync("alert", "사용자 생성 실패");
            User = new UserDTO();
            return;
        }



        User = new UserDTO();
        Navigation.NavigateTo("/users");
    }

    private async void OnCancle()
    {
        User = new UserDTO();
        Navigation.NavigateTo("/users");
    }
}
